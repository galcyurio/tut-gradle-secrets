/**
 * Gradle task 매개변수를 통해서 비밀번호를 입력받고
 * 비밀번호를 입력하지 않았으면 `password` 환경변수를 참조한다.
 */
task initSecrets3 doLast {
    if (project.hasProperty('password')) {
        ext.password = password
    } else {
        ext.password = System.getenv('password')
    }
}

/**
 * ## Bash
 * ./gradlew build4Production3 -P password=$password
 * ./gradlew build4Production3
 *
 * ## Windows
 * gradlew.bat initSecrets3 -P password=%password%
 * gradlew.bat initSecrets3
 *
 * NOTE: 환경변수를 설정한 후에는 프로그램을 종료하고
 * 다시 실행해야 변경된 환경변수를 인식합니다.
 */
task build4Production3 {
    dependsOn initSecrets3

    dependsOn build
    build.dependsOn initSecrets3

    doLast {
        def password = initSecrets3.password
        println password
        // TODO: Do something
    }
}